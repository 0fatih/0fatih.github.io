I"˜<p>Merhaba, sizlere bu yazÄ±da aÃ§Ä±klayacaÄŸÄ±m konunun ismi; Web Ã–nbellek Zehirlemesi. AsÄ±l konumuza gelmeden Ã¶nce bazÄ± temel bilgiler vermeliyim.</p>

<h2 id="cache-memory-Ã¶nbellek-nedir">Cache Memory (Ã–nbellek) Nedir?</h2>

<p>Her ne kadar birÃ§ok Ã§eÅŸidi olsa da (bilgisayar Ã¶nbelliÄŸi, sunucu Ã¶nbelleÄŸi, veritabanÄ± Ã¶nbelleÄŸi vs.), hepsinin amacÄ± aynÄ±dÄ±r; bizlere daha hÄ±zlÄ± hizmet vermek. Ã–nbelleklerin boyutlarÄ±, diÄŸer belleklere gÃ¶re Ã§ok daha kÃ¼Ã§Ã¼ktÃ¼r. Ã‡Ã¼nkÃ¼, diÄŸer belleklerden kat kat daha hÄ±zlÄ± iÅŸlem yaparlar. Ã–rneÄŸin, kiÅŸisel bilgisayarlarÄ±mÄ±zdaki Ã¶nbelleklerin boyutlarÄ± MegaByteâ€™larla Ã¶lÃ§Ã¼lÃ¼r.</p>

<p>Web Ã¶nbellekleri ise, bizlere hedef sitemizi getirmeye yardÄ±mcÄ± olan, <a href="https://www.cloudflare.com/learning/cdn/what-is-a-cdn/">CDN</a> gibi serverlarÄ±n Ã¶nbellekleridir. EÄŸer, girmek istediÄŸiniz bir web sunucusu size Ã§ok uzak ise, CDNâ€™ler burada devreye girer. DÃ¼nyaâ€™da birÃ§ok yerde bulunan CDNâ€™ler, belirli aralÄ±klarla sizin ulaÅŸmak istediÄŸiniz web sitesini Ã¶nbelleÄŸine kaydeder (tabii o web sitesinin herhangi bir CDN sunucu hizmeti alÄ±yorsa). Bunun amacÄ±, tekrar tekrar web sitesi sunucusuna kadar gitmemize engel olmaktÄ±r.</p>

<p><img src="https://www.cloudflare.com/img/learning/cdn/what-is-a-cdn/what-is-a-cdn.png" alt="CDN" /></p>

<p>Siz bir siteye girmek isteÄŸinizi gÃ¶nderdiniz. Ama CDN sunuucusu, sizin istediÄŸiniz siteyi Ã¶nbelleÄŸine almamÄ±ÅŸ. Bu durumda, CDN web sunucusuna baÅŸvururak siteyi bize getirir. Ve bir sonraki istekte daha hÄ±zlÄ± davranabilmek iÃ§in, bu siteyi kendi Ã¶nbelleÄŸine kaydeder. Bunun sonucunda, bizden sonra herhangi birisi o siteye istek atarsa, Ã§ok daha hÄ±zlÄ± bir ÅŸekilde ulaÅŸmasÄ± olasÄ±dÄ±r.</p>

<h2 id="web-Ã¶nbellekleri-nasÄ±l-Ã§alÄ±ÅŸÄ±r">Web Ã–nbellekleri NasÄ±l Ã‡alÄ±ÅŸÄ±r?</h2>

<p>Sunucu, kendisine gelen bir isteÄŸin, Ã¶nbelleÄŸinde bulunup bulunmadÄ±ÄŸÄ±nÄ± nasÄ±l anlar? Belki aklÄ±nÄ±za, byte-byte karÅŸÄ±laÅŸtÄ±rmak gelmiÅŸ olabilir. Ancak, aynÄ± siteye ulaÅŸmak iÃ§in, farklÄ± iki bilgisayardan gÃ¶nderilen HTTP istekleri, temel birkaÃ§ ÅŸeyin aynÄ± olmasÄ± ile dÄ±ÅŸÄ±nda, muhtemelen farklÄ± olacaktÄ±r. Ã–rneÄŸin, <a href="https://www.howtogeek.com/114937/htg-explains-whats-a-browser-user-agent/">User-Agent</a> baÅŸlÄ±ÄŸÄ± gibi. Bu sorunu aÅŸmak iÃ§in, anahtarlama sistemi ortaya Ã§Ä±karÄ±lmÄ±ÅŸtÄ±r. Gelen istekte, birkaÃ§ adet baÅŸlÄ±ÄŸÄ±n, Ã¶nbellekte bulunan isteÄŸin baÅŸlÄ±klarÄ± ile uyuÅŸmasÄ± durumunda, sunucu Ã¶nbellekteki siteyi, istek yapan kiÅŸiye gÃ¶nderecektir. Mesela ÅŸÃ¶yle bir istek olsun;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    GET /#blog HTTP/1.1
    Host: fatihfurkan.site
    User-Agent: Mozilla/5.0 â€¦ Firefox/57.0
    Accept-Language: tr
    Connection: close
</code></pre></div></div>

<p>Sunucu yapÄ±landÄ±rmasÄ±na gÃ¶re sadece, host baÅŸlÄ±ÄŸÄ± ve istenilen dizin (/#blog) anahtarlandÄ±rÄ±lmÄ±ÅŸ olsun. Bu durumda, sunucu iki anahtarÄ± birbiri ile uyuÅŸan isteklere, Ã¶nbelleÄŸindeki yanÄ±tÄ± dÃ¶ndÃ¼recektir. Ä°ÅŸte sorun burada baÅŸlÄ±yor. Peki ya anahtarlanmamÄ±ÅŸ baÅŸlÄ±klar ne olacak? Mesela, dili (language) deÄŸiÅŸtirerek bir istek atalÄ±m.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    GET /#blog HTTP/1.1
    Host: fatihfurkan.site
    User-Agent: Mozilla/5.0 â€¦ Firefox/57.0
    Accept-Language: tr
    Connection: close
</code></pre></div></div>

<p>Sunucu, yaptÄ±ÄŸÄ± anahtar eÅŸleÅŸtirmesinin pozitif sonuÃ§ Ã¼retmesinden Ã¶tÃ¼rÃ¼, bize Ã¶nceki isteÄŸimize gÃ¶nderdiÄŸi yanÄ±tÄ± dÃ¶ndÃ¼recektir. Ama biz parametre deÄŸiÅŸtirdik. Neden aynÄ± yanÄ±t geldi? Ã‡Ã¼nkÃ¼, sunucu dil parametresini algÄ±lamak iÃ§in yapÄ±landÄ±rÄ±lmadÄ±. Ä°ÅŸte Web Cache Poisoning aÃ§Ä±ÄŸÄ±nÄ±n ortaya Ã§Ä±ktÄ±ÄŸÄ± kÄ±sÄ±m burasÄ±. AyrÄ±ca ÅŸunu da belirtmeliyim ki, cache poisoning iÅŸlemi sadece aÅŸaÄŸÄ±da anlattÄ±ÄŸÄ±m ÅŸekilde deÄŸil, <a href="https://fatihfurkan.site/2020/HTTP-Request-Smuggling/">HTTP Request Smuggling</a> ve <a href="https://fatihfurkan.site/2020/HTTP-Response-Splitting/">HTTP Response Splitting</a> ile de yapÄ±labilir.</p>

<h2 id="web-Ã¶nbellek-zehirlemesi">Web Ã–nbellek Zehirlemesi</h2>

<p>Åimdi, dil parametresi anahtarlanmamÄ±ÅŸ. Bu yÃ¼zden sunucu, dil parametresini Ã¶nemsemeden, diÄŸer anahtarlarÄ±n uyuÅŸmasÄ± halinde, Ã¶nbelleÄŸindeki yanÄ±tÄ± gÃ¶nderecektir. Peki, biz aÅŸaÄŸÄ±daki gibi bir isteÄŸi, sunucu Ã¶nbelleÄŸine yerleÅŸtirebilirsek ne olur?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    GET /#blog HTTP/1.1
    Host: fatihfurkan.site
    User-Agent: Mozilla/5.0 â€¦ Firefox/57.0
    Accept-Language: &lt;script&gt;alert(document.domain)&lt;/script&gt;
    Connection: close
</code></pre></div></div>

<p>EÄŸer sunucuya giden bir isteÄŸin anahtarlarÄ±, bizim isteÄŸimizdeki anahtarlarla aynÄ± ise; sunucu, Ã¶nbelleÄŸine yerleÅŸtirdiÄŸimiz yanÄ±tÄ± dÃ¶ndÃ¼recektir. DÃ¶nen yanÄ±tÄ±n iÃ§erisinde, istekte gÃ¶nderdiÄŸimiz dil parametresi de olacaÄŸÄ± iÃ§in, yazdÄ±ÄŸÄ±mÄ±z script, istek sahibinin bilgisayarÄ±nda Ã§alÄ±ÅŸacaktÄ±r.</p>

<p>Ä°steÄŸimizi, sunucu Ã¶nbelliÄŸine nasÄ±l yerleÅŸtireceÄŸiz? Ã–nbellekere alÄ±nan isteklerin sona erme sÃ¼resi vardÄ±r. Bu sÃ¼re bittikten sonra, sunucu Ã¶nbelleÄŸindeki isteÄŸi tazelemek iÃ§in, kendisine gelen ilk istek iÃ§in web sunucusuna baÅŸvuracaktÄ±r. Bizim amacÄ±mÄ±z ise, Ã§ok fazla istek atarak veya o sÃ¼re bitimini yakalayarak isteÄŸimizi, Ã¶nbelleÄŸe dÃ¼ÅŸÃ¼rmektir.</p>

<p>Tabii, burdan sonrasÄ± sizin hayagÃ¼cÃ¼nÃ¼ze kalmÄ±ÅŸ.</p>

<p><strong>Fatih Furkan HatipoÄŸlu</strong></p>

<p>Â </p>

<p>Bana bu kadar bilgi yetmez, daha fazlasÄ±nÄ± istiyorum diyenler iÃ§in birkaÃ§ tavsiye kaynak:</p>

<p><a href="https://portswigger.net/research/practical-web-cache-poisoning"> PortSwigger - Pratical Web Cache Poisoning (AraÅŸtÄ±rma)</a></p>

<p><a href="https://portswigger.net/web-security/web-cache-poisoning"> PortSwigger - Web Cache Poisoning </a></p>
:ET